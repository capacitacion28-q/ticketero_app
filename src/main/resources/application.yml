# Configuración del Sistema Ticketero
# Basado en: docs/implementation/plan_detallado_implementacion_v1.0.md

spring:
  application:
    name: sistema-ticketero
  
  # Configuración H2 para testing rápido
  datasource:
    url: jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    username: sa
    password: 
    driver-class-name: org.h2.Driver
  
  # Configuración JPA/Hibernate para H2
  jpa:
    hibernate:
      ddl-auto: create-drop  # H2 recrea schema automáticamente
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.H2Dialect
        format_sql: true
  
  # H2 Console para debugging (opcional)
  h2:
    console:
      enabled: true
      path: /h2-console
  
  # Flyway deshabilitado para H2
  flyway:
    enabled: false

# Configuración de Schedulers según RF-002 y RF-003
scheduler:
  message:
    # Procesamiento de mensajes cada 60 segundos
    fixed-rate: ${SCHEDULER_MESSAGE_RATE:60000}
  queue:
    # Procesamiento de colas cada 5 segundos
    fixed-rate: ${SCHEDULER_QUEUE_RATE:5000}
  thread-pool-size: ${SCHEDULER_THREAD_POOL_SIZE:2}

# Configuración Telegram Bot API según ADR-002
telegram:
  bot-token: ${TELEGRAM_BOT_TOKEN:dummy-token-change-me}
  api-url: ${TELEGRAM_API_URL:https://api.telegram.org/bot}
  timeout: ${TELEGRAM_TIMEOUT:30000}
  default-chat-id: ${TELEGRAM_DEFAULT_CHAT_ID:5598409030}
  bot:
    enabled: ${TELEGRAM_BOT_ENABLED:false}
    
# Configuración de Reintentos según ADR-001 (RN-007, RN-008)
retry:
  telegram:
    max-attempts: ${RETRY_MAX_ATTEMPTS:3}
    backoff:
      initial-delay: ${RETRY_INITIAL_DELAY:30000}    # 30 segundos
      multiplier: ${RETRY_MULTIPLIER:2.0}         # Backoff exponencial
      max-delay: ${RETRY_MAX_DELAY:120000}       # 120 segundos máximo

# Configuración de Auditoría según RN-011 y RN-013
audit:
  retention-days: ${AUDIT_RETENTION_DAYS:2555}  # 7 años
  batch-size: ${AUDIT_BATCH_SIZE:1000}

# Configuración de Colas según RN-002, RN-003, RN-004
queue:
  timeout:
    no-show-minutes: ${NO_SHOW_TIMEOUT:5}  # RN-009: Timeout NO_SHOW 5 minutos
  priority:
    # Orden de prioridad para RN-002
    order: "CRITICA,PREFERENCIAL,EMPRESARIAL,GENERAL"
  advisor:
    max-concurrent: ${MAX_CONCURRENT_TICKETS:3}  # Máximo tickets por asesor

# Configuración de Logging
logging:
  level:
    com.example.ticketero: INFO
    org.springframework.retry: DEBUG
    org.flywaydb: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# Configuración del servidor
server:
  port: ${SERVER_PORT:8080}