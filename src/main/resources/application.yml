# Configuración del Sistema Ticketero
# Basado en: docs/implementation/plan_detallado_implementacion_v1.0.md

spring:
  application:
    name: sistema-ticketero
  
  # Configuración PostgreSQL según stack tecnológico
  datasource:
    url: jdbc:postgresql://localhost:5432/ticketero_db
    username: ticketero_user
    password: ticketero_pass
    driver-class-name: org.postgresql.Driver
  
  # Configuración JPA/Hibernate
  jpa:
    hibernate:
      ddl-auto: validate  # Flyway maneja el schema
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
  
  # Configuración Flyway según ADR-004
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    validate-on-migrate: true

# Configuración de Schedulers según RF-002 y RF-003
scheduler:
  message:
    # Procesamiento de mensajes cada 60 segundos
    fixed-rate: ${SCHEDULER_MESSAGE_RATE:60000}
  queue:
    # Procesamiento de colas cada 5 segundos
    fixed-rate: ${SCHEDULER_QUEUE_RATE:5000}

# Configuración Telegram Bot API según ADR-002
telegram:
  bot:
    token: ${TELEGRAM_BOT_TOKEN:dummy-token-for-dev}
    api-url: https://api.telegram.org/bot
    timeout: ${TELEGRAM_TIMEOUT:30000}
    
# Configuración de Reintentos según ADR-001 (RN-007, RN-008)
retry:
  telegram:
    max-attempts: 3
    backoff:
      initial-delay: 30000    # 30 segundos
      multiplier: 2.0         # Backoff exponencial
      max-delay: 120000       # 120 segundos máximo

# Configuración de Auditoría según RN-011 y RN-013
audit:
  retention-days: ${AUDIT_RETENTION_DAYS:2555}  # 7 años
  batch-size: ${AUDIT_BATCH_SIZE:1000}

# Configuración de Colas según RN-002, RN-003, RN-004
queue:
  timeout:
    no-show-minutes: ${NO_SHOW_TIMEOUT:5}  # RN-009: Timeout NO_SHOW 5 minutos
  priority:
    # Orden de prioridad para RN-002
    order: "CRITICA,PREFERENCIAL,EMPRESARIAL,GENERAL"
  advisor:
    max-concurrent: ${MAX_CONCURRENT_TICKETS:3}  # Máximo tickets por asesor

# Configuración de Logging
logging:
  level:
    com.example.ticketero: INFO
    org.springframework.retry: DEBUG
    org.flywaydb: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# Configuración del servidor
server:
  port: ${SERVER_PORT:8080}
  servlet:
    context-path: /api/v1